<%= render layout: layout do |f| %>
  <%= f.hidden_field :response, value: nil %>
  <% if @step.raw.fetch("fields", "extendedOptions", "options").present? %>
    <%= f.govuk_radio_buttons_fieldset(:response, legend: { size: 'm', text: @step.title }) do %>
      <% @step.raw["fields"]["extendedOptions"]["options"].each do |option| %>
        <%= f.govuk_radio_button :response, option["value"].downcase, label: { text: option["value"] } do %>
          <% if option["further_information_required"] == true %>
            <%= f.govuk_text_area :further_information, rows: 1, label: { text: option["further_information_help_text"] } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <%= f.govuk_collection_radio_buttons :response,
      radio_options(array_of_options: @step.options),
      :id,
      ->(option) { option.name },
      :description,
      legend: { text: @step.title, size: 'xl' },
      hint: { text: @step.help_text },
      inline: false
    %>
  <% end %>
<% end %>
